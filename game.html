<!DOCTYPE html>
<html lang="pt-br">
<head>

<!-- PushAlert -->
<script type="text/javascript">
        (function(d, t) {
                var g = d.createElement(t),
                s = d.getElementsByTagName(t)[0];
                g.src = "https://cdn.pushalert.co/integrate_0ccaec8817bb821b417e69ef8b9485a0.js";
                s.parentNode.insertBefore(g, s);
        }(document, "script"));
</script>
<!-- End PushAlert -->


  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Detalhes do Jogo - CM Store</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://websfctype.vercel.app/Websfctype/Websfctype-main-@version104.js"></script>
<script src="https://caiolibs.vercel.app/info.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Roboto', sans-serif; background-color: #002B36; color: #FFFFFF; }

    .navbar {
      background-color: #003C4C;
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: fixed;
      width: 100%;
      top: 0;
      left: 0;
      z-index: 1000;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
    }

    .back-button { 
      color: #FFFFFF; 
      text-decoration: none; 
      font-size: 1.2em;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .game-container {
      max-width: 800px;
      margin: 100px auto 30px;
      padding: 20px;
      background-color: #004F5F;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    .game-header {
      display: flex;
      align-items: center;
      gap: 20px;
      margin-bottom: 20px;
    }

    .game-icon-large {
      width: 120px;
      height: 120px;
      border-radius: 20px;
      object-fit: cover;
      border: 3px solid #FFA000;
    }

    .game-title {
      font-size: 2em;
      margin-bottom: 5px;
      color: #FFA000;
    }

    .game-developer {
      font-size: 1.1em;
      color: #f0f0f0;
      margin-bottom: 10px;
    }

    .game-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 20px;
    }

    .game-meta-item {
      background-color: #006373;
      padding: 5px 10px;
      border-radius: 5px;
      font-size: 0.9em;
    }

    .game-section {
      margin-bottom: 25px;
    }

    .game-section-title {
      font-size: 1.4em;
      margin-bottom: 10px;
      color: #FFA000;
      border-bottom: 2px solid #FFA000;
      padding-bottom: 5px;
    }

    .game-description {
      line-height: 1.6;
      margin-bottom: 20px;
    }

    .video-container {
      position: relative;
      padding-bottom: 56.25%; /* Proporção 16:9 */
      height: 0;
      overflow: hidden;
      margin-bottom: 20px;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    }

    .video-container iframe {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border: none;
      border-radius: 8px;
    }

    .download-btn {
      display: block;
      width: 100%;
      padding: 15px;
      background: linear-gradient(90deg, #FFA000, #FF6F00);
      color: #FFFFFF;
      text-align: center;
      text-decoration: none;
      font-weight: bold;
      border-radius: 5px;
      margin-top: 20px;
      transition: transform 0.3s, box-shadow 0.3s;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
    }

    .download-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 10px rgba(0, 0, 0, 0.3);
    }

    .download-btn.disabled {
      background: linear-gradient(90deg, #607D8B, #455A64);
      cursor: not-allowed;
    }

    .screenshots-container {
      display: flex;
      overflow-x: auto;
      margin-top: 15px;
    }

    .screenshot {
      width: 100%;
      border-radius: 8px;
      border: 2px solid #FFA000;
      transition: transform 0.3s;
      cursor: pointer;
    }

    .screenshot:hover {
      transform: scale(1.03);
    }

    .age-rating {
      display: inline-flex;
      align-items: center;
      padding: 3px 8px;
      border-radius: 4px;
      font-weight: bold;
      font-size: 0.9em;
    }

    .age-rating.L { background-color: #4CAF50; }
    .age-rating.10 { background-color: #8BC34A; }
    .age-rating.12 { background-color: #FFC107; color: #000; }
    .age-rating.14 { background-color: #FF9800; }
    .age-rating.16 { background-color: #F44336; }
    .age-rating.18 { background-color: #D32F2F; }

    /* Novos estilos para jogos do mesmo desenvolvedor */
    .more-games-container {
      margin: 30px 0;
    }

    .more-games-title {
      font-size: 1.4em;
      margin-bottom: 15px;
      color: #FFA000;
      border-bottom: 2px solid #FFA000;
      padding-bottom: 5px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .verified-badge {
      color: #4CAF50;
      font-size: 1.2em;
      display: none; /* Inicialmente escondido */
    }

    .games-scroll {
      display: flex;
      overflow-x: auto;
      gap: 15px;
      padding: 10px 0;
    }

    .game-card {
      min-width: 150px;
      background-color: #006373;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 3px 6px rgba(0, 0, 0, 0.2);
      transition: transform 0.3s;
    }

    .game-card:hover {
      transform: translateY(-5px);
    }

    .game-card-img {
      width: 150px;
      height: 150px;
      object-fit: cover;
    }

    .game-card-info {
      padding: 10px;
    }

    .game-card-title {
      font-size: 0.9em;
      margin-bottom: 5px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .game-card-dev {
      font-size: 0.8em;
      color: #f0f0f0;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    @media (max-width: 768px) {
      .game-header {
        flex-direction: column;
        text-align: center;
      }

      .game-meta {
        justify-content: center;
      }

      .screenshots-container {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <nav class="navbar">
    <a href="index.html" class="back-button"><i class="fas fa-arrow-left"></i> Voltar</a>
    <h1 id="nm">CM Store</h1>
    <button id="share" onclick="share()" style="border: none; background-color: transparent; color: white; font-size: 1.1em; cursor: pointer;">
      <i class="fa-solid fa-share"></i> Compartilhar
    </button>
  </nav>

  <div class="game-container" id="game-container">
    <!-- Conteúdo será preenchido pelo JavaScript -->
  </div>

  <script src="log.js"></script>

  <script>
if(!localStorage.getItem("termos") ) {
setTimeout( ()=> {
info("Por favor, leia os termos!", {
  duration: 7000,
  position: "top-left",
  fullFocus: true,
  onClick: () => window.location.href = "termos.html"
});
},2000)
}

// Obter ID do jogo da URL
const urlParams = new URLSearchParams(window.location.search);
const gameId = urlParams.get('id');

if (!gameId) {
  showGameNotFound();
}

// Referência ao banco de dados
const db = firebase.database();
const container = document.getElementById('game-container');

// Função auxiliar para criar elementos com atributos
function createElement(tag, attributes = {}, textContent = '') {
  const element = document.createElement(tag);
  for (const [key, value] of Object.entries(attributes)) {
    element.setAttribute(key, value);
  }
  if (textContent) element.textContent = textContent;
  return element;
}

// Carregar dados do jogo
db.ref('jogos/' + gameId).once('value').then(snapshot => {
  const game = snapshot.val();

  if (!game) {
    showGameNotFound();
    return;
  }

  document.title = `${game.nome || 'Jogo sem nome'} - CM Store`;

  // Limpar container
  container.innerHTML = '';

  // Cabeçalho do jogo
  const gameHeader = createElement('div', { class: 'game-header' });

  const gameIcon = createElement('img', {
    class: 'game-icon-large',
    src: game.icone || 'https://via.placeholder.com/120',
    alt: `Ícone do jogo ${game.nome || ''}`,
    onerror: "this.src='https://via.placeholder.com/120'"
  });

  const headerContent = createElement('div');
  const gameTitle = createElement('h1', { class: 'game-title' }, game.nome || 'Jogo sem nome');
  const gameDeveloper = createElement('p', { class: 'game-developer' }, `Desenvolvedor: ${game.dev || 'Não especificado'}`);

  const gameMeta = createElement('div', { class: 'game-meta' });

  // Gênero
  if (game.genero) {
    const genreMeta = createElement('span', { class: 'game-meta-item' }, game.genero.charAt(0).toUpperCase() + game.genero.slice(1));
    gameMeta.appendChild(genreMeta);
  }

  // Versão (só mostra se existir e não for anúncio)
  if (game.versao && game.link) {
    const versionMeta = createElement('span', { class: 'game-meta-item' }, `Versão: ${game.versao}`);
    gameMeta.appendChild(versionMeta);
  }

  // Classificação indicativa
  if (game.classificacao) {
    const ratingMeta = createElement('span', { class: 'game-meta-item' });
    const ratingSpan = createElement('span', { class: `age-rating ${game.classificacao}` }, game.classificacao === 'L' ? 'Livre' : `${game.classificacao}+`);
    ratingMeta.appendChild(document.createTextNode('Classificação: '));
    ratingMeta.appendChild(ratingSpan);
    gameMeta.appendChild(ratingMeta);
  }

  // Tamanho (para jogos antigos)
  if (game.tamanho) {
    const sizeMeta = createElement('span', { class: 'game-meta-item' }, `Tamanho: ${game.tamanho}`);
    gameMeta.appendChild(sizeMeta);
  }

  headerContent.append(gameTitle, gameDeveloper, gameMeta);
  gameHeader.append(gameIcon, headerContent);

  // Seção de descrição
  const descriptionSection = createElement('div', { class: 'game-section' });
  const descTitle = createElement('h3', { class: 'game-section-title' }, 'Descrição');
  const descContent = createElement('p', { class: 'game-description' }, 
    game.descricao || 'Este jogo não possui descrição disponível.');
  descriptionSection.append(descTitle, descContent);

  // Adicionar ao container principal
  container.append(gameHeader, descriptionSection);

  // Seção de screenshots (se existir)
  if (game.prints && game.prints.length > 0) {
    const screenshotsSection = createElement('div', { class: 'game-section' });
    const screenshotsTitle = createElement('h3', { class: 'game-section-title' }, 'Imagens do Jogo');

    const screenshotsContainer = createElement('div', { class: 'screenshots-container' });

    game.prints.slice(0, 3).forEach(print => {
      const screenshot = createElement('img', {
        class: 'screenshot',
        src: print,
        alt: 'Screenshot do jogo',
        loading: 'lazy'
      });
      screenshotsContainer.appendChild(screenshot);
    });

    screenshotsSection.append(screenshotsTitle, screenshotsContainer);
    container.appendChild(screenshotsSection);
  }

  // Seção de vídeo (se existir)
  if (game.video) {
    const videoSection = createElement('div', { class: 'game-section' });
    const videoTitle = createElement('h3', { class: 'game-section-title' }, 'Vídeo do Jogo');

    const videoContainer = createElement('div', { class: 'video-container' });
    const videoIframe = createElement('iframe', {
      src: game.video,
      frameborder: '0',
      allow: 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture',
      allowfullscreen: ''
    });

    videoContainer.appendChild(videoIframe);
    videoSection.append(videoTitle, videoContainer);
    container.appendChild(videoSection);
  }

  // Botão de download (só mostra se não for apenas anúncio)
  if (game.link) {
    const downloadBtn = createElement('a', {
      class: 'download-btn',
      href: game.link,
      target: '_blank'
    }, 'BAIXAR JOGO');
    container.appendChild(downloadBtn);
  } else {
    const downloadBtn = createElement('div', {
      class: 'download-btn disabled'
    }, 'EM BREVE');
    container.appendChild(downloadBtn);
  }

  // Seção de mais jogos do mesmo desenvolvedor (se tiver idUser)
  if (game.idUser) {
    const moreGamesSection = createElement('div', { class: 'more-games-container' });
    
    // Criar título com possibilidade de badge verificado
    const moreGamesTitle = createElement('h3', { class: 'more-games-title' });
    moreGamesTitle.textContent = 'Mais jogos deste desenvolvedor';
    
    // Criar badge verificado (inicialmente escondido)
    const verifiedBadge = createElement('i', { 
      class: 'fas fa-check-circle verified-badge',
      title: 'Arquivo confiável'
    });
    gameTitle.appendChild(verifiedBadge);
    
    const gamesScroll = createElement('div', { class: 'games-scroll' });
    
    // Carregar lista de desenvolvedores verificados
    db.ref('vv').once('value').then(vvSnapshot => {
      const verifiedUsers = vvSnapshot.val() || {};
      
      // Verificar se o idUser está na lista de verificados
      if (verifiedUsers[game.idUser]) {
        verifiedBadge.style.display = 'inline-block';
      }
      
      // Carregar outros jogos do mesmo desenvolvedor
      db.ref('jogos').orderByChild('idUser').equalTo(game.idUser).once('value').then(gamesSnapshot => {
        const games = gamesSnapshot.val() || {};
        
        // Filtrar o jogo atual e limitar a 10 jogos
        Object.entries(games).forEach(([id, gameData]) => {
          if (id !== gameId && gamesScroll.children.length < 10) {
            const gameCard = createElement('a', {
              class: 'game-card',
              href: `game.html?id=${id}`
            });
            
            const gameCardImg = createElement('img', {
              class: 'game-card-img',
              src: gameData.icone || 'https://via.placeholder.com/150',
              alt: gameData.nome || 'Jogo sem nome',
              onerror: "this.src='https://via.placeholder.com/150'"
            });
            
            const gameCardInfo = createElement('div', { class: 'game-card-info' });
            const gameCardTitle = createElement('div', { class: 'game-card-title' }, gameData.nome || 'Jogo sem nome');
            const gameCardDev = createElement('div', { class: 'game-card-dev' }, gameData.dev || 'Desenvolvedor desconhecido');
            
            gameCardInfo.append(gameCardTitle, gameCardDev);
            gameCard.append(gameCardImg, gameCardInfo);
            gamesScroll.appendChild(gameCard);
          }
        });
        
        // Se não houver outros jogos, mostrar mensagem
        if (gamesScroll.children.length === 0) {
          const noGamesMsg = createElement('p', {}, 'Nenhum outro jogo encontrado deste desenvolvedor.');
          gamesScroll.appendChild(noGamesMsg);
        }
      });
    });
    
    moreGamesSection.append(moreGamesTitle, gamesScroll);
    container.appendChild(moreGamesSection);
  }

  // Seção de comentários
  const commentsSection = createElement('div', { class: 'game-section' });
  const commentsTitle = createElement('h3', { class: 'game-section-title' }, 'Comentários');
  const disqusThread = createElement('div', { id: 'disqus_thread' });

  commentsSection.append(commentsTitle, disqusThread);
  container.appendChild(commentsSection);

  // Carregar Disqus
  loadDisqus(gameId);

}).catch(error => {
  console.error('Erro ao carregar dados do jogo:', error);
  showErrorLoading();
});

function loadDisqus(gameId) {
  window.disqus_config = function() {
    this.page.url = window.location.href;
    this.page.identifier = gameId;
  };

  const script = document.createElement('script');
  script.src = 'https://cm-store.disqus.com/embed.js';
  script.setAttribute('data-timestamp', +new Date());
  (document.head || document.body).appendChild(script);
}

function showGameNotFound() {
  container.innerHTML = '';

  const title = createElement('h2', {style: 'color: #FFA000; margin-bottom: 15px;'}, 'Jogo não encontrado');
  const message = createElement('p', {style: 'margin-bottom: 20px;'}, 
    'O jogo solicitado não foi encontrado em nossa base de dados.');
  const backBtn = createElement('a', {
    class: 'download-btn',
    href: 'index.html',
    style: 'text-align: center;'
  }, 'Voltar para a loja');

  container.append(title, message, backBtn);
}

function showErrorLoading() {
  container.innerHTML = '';

  const title = createElement('h2', {style: 'color: #FFA000; margin-bottom: 15px;'}, 'Erro ao carregar');
  const message = createElement('p', {style: 'margin-bottom: 20px;'}, 
    'Ocorreu um erro ao carregar os dados do jogo. Por favor, tente novamente mais tarde.');
  const backBtn = createElement('a', {
    class: 'download-btn',
    href: 'index.html',
    style: 'text-align: center;'
  }, 'Voltar para a loja');

  container.append(title, message, backBtn);
}

function share() {
  if (navigator.share) {
    navigator.share({
      title: document.title,
      text: 'Confira este jogo na CM Store!',
      url: window.location.href
    }).catch(err => {
      console.log('Erro ao compartilhar:', err);
      fallbackShare();
    });
  } else {
    fallbackShare();
  }
}

function fallbackShare() {
  // Copia a URL para a área de transferência
  navigator.clipboard.writeText(window.location.href).then(() => {
    alert('Link copiado para a área de transferência!');
  }).catch(err => {
    console.log('Erro ao copiar link:', err);
    prompt('Copie o link abaixo:', window.location.href);
  });
}
  </script>
</body>
</html>