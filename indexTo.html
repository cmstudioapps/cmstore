<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CM Store</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script src="https://websfctype.vercel.app/Websfctype/Websfctype-main-@version104.js"></script>
  <style>
    /* Estilos CSS permanecem os mesmos */
  </style>
  <script>
    // Função para obter parâmetros da URL
    function obterParametro(nome) {
      const params = new URLSearchParams(window.location.search);
      return params.get(nome);
    }

    // Configuração do Disqus
    var disqus_config = function () {
      this.page.url = window.location.href;  // URL da página
      this.page.identifier = obterParametro("p") || "default"; // Identificador único
    };

    (function() { // DON'T EDIT BELOW THIS LINE
      var d = document, s = d.createElement('script');
      s.src = 'https://cm-store.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
  <script src="alert.js"></script>
</head>
<body>
  <script src="menu.js"></script>
  <br><br><br><br><br>
  <h2 style="text-align: center;">Jogo do mês:</h2><br>
  <img src="readvator.png" alt="" height="300px" style="border-radius: 10%; box-shadow: 0px 9px 8px black;" width="100%">

  <h3>Lançamentos (últimos 10 dias)</h3>
  <div class="containerHorizontal" id="recent-games"></div>

  <h3>Recomendações</h3>
  <div class="containerHorizontal" id="recommended-games"></div>

  <button id="fab" class="fab" onclick="window.location.href='upload.html'">+</button>

  <footer><p>Dev: Caio Multiversando</p></footer>
  <script src="log.js"></script>
  <script>
    var fab = document.getElementById("fab");
    if (!localStorage.getItem("modo") || localStorage.getItem("modo") != "1") {
      fab.style.display = "none";
    } else {
      fab.style.display = "block";
    }
  </script>
  <script>
    var db = firebase.database();

    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    function loadGames() {
      db.ref('jogos/').once('value', snapshot => {
        const recentContainer = document.getElementById('recent-games');
        const recommendedContainer = document.getElementById('recommended-games');
        recentContainer.innerHTML = "";
        recommendedContainer.innerHTML = "";

        const now = new Date();
        const games = [];
        snapshot.forEach(child => {
          const game = child.val();
          game.key = child.key;
          games.push(game);
        });

        const shuffledGames = shuffleArray(games);
        const searchParam = obterParametro("p"); // Obtém o parâmetro 'p' da URL

        if (searchParam) {
          // Se houver um parâmetro de pesquisa, exibe apenas o jogo correspondente
          const game = games.find(g => g.key === searchParam);
          if (game) {
            recentContainer.innerHTML = createGameCard(game);
          } else {
            recentContainer.innerHTML = "<p>Jogo não encontrado.</p>";
          }
        } else {
          // Se não houver pesquisa, mostra normalmente
          games.forEach(game => {
            const gameDate = new Date(game.dataEnvio);
            const diffTime = Math.abs(now - gameDate);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

            if (diffDays <= 10) {
              recentContainer.innerHTML += createGameCard(game);
            }
          });

          shuffledGames.forEach(game => {
            recommendedContainer.innerHTML += createGameCard(game);
          });
        }

        scrollToGame();
      });
    }

    function createGameCard(game) {
      const videoIframe = game.video
        ? `<iframe width="100%" height="200" src="${game.video}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>`
        : "";

      return `
        <div class="game-card" id="${game.key}">
          <img src="${game.icone}" alt="Ícone do Jogo" class="game-icon">
          <h2 class="game-title">${game.nome}</h2>
          <strong>${game.genero}</strong>
          <details>
            <summary>Sobre o jogo</summary>
            <p class="game-description">${game.descricao}</p>
            <p>${game.versao}</p>
          </details>
          ${videoIframe}
          <div class="actions">
            <a href="${game.link}" class="btn btn-download" target="_blank">Baixar</a>
            <button class="btn btn-like">Curtir</button>
            <button onclick="share('${game.key}', '${game.nome}')" style="background-color: transparent; border: none;">
              <img style="height: 50px;" src="https://i.imgur.com/45QyJhQ.png">
            </button>
          </div>
          <div id="disqus_thread_${game.key}"></div>
          <script>
            var disqus_config_${game.key} = function () {
              this.page.url = window.location.href + "?p=${game.key}";
              this.page.identifier = "${game.key}";
            };
            (function() {
              var d = document, s = d.createElement('script');
              s.src = 'https://cm-store.disqus.com/embed.js';
              s.setAttribute('data-timestamp', +new Date());
              (d.head || d.body).appendChild(s);
            })();
          </script>
        </div>`;
    }

    function toggleMenu() {
      document.getElementById("mobileMenu").classList.toggle("active");
    }

    function share(key, name) {
      let url = window.location.href.split('?')[0] + "?p=" + key;
      navigator.clipboard.writeText(url);
      navigator.share({
        title: name,
        text: "Venha jogar " + name + "\n" + url
      });
    }

    function scrollToGame() {
      if (window.location.hash) {
        const targetId = window.location.hash.substring(1);
        const targetElement = document.getElementById(targetId);
        if (targetElement) {
          targetElement.scrollIntoView({ behavior: "smooth" });
        }
      }
    }

    loadGames();
  </script>
  <script src="main.js"></script>
</body>
</html>